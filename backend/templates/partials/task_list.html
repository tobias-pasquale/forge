{# partials/task_list.html #}

{# Separate active and completed tasks #}
{% set active_tasks = tasks | selectattr("completed", "equalto", False) | list %}
{% set completed_tasks = tasks | selectattr("completed", "equalto", True) | list %}

<h5 class="text-warning mt-4">Active Tasks</h5>
<ul id="activeTasksList" class="list-group mb-4">
  {% for task in active_tasks %}
    <li id="task-{{ task.id }}" class="list-group-item d-flex justify-content-between align-items-center border-secondary">
      <div class="d-flex align-items-center">
        <input type="checkbox"
               name="completed"
               onchange="toggleTaskComplete({{ task.id }})"
               class="form-check-input me-2"
               {% if task.completed %}checked{% endif %}>
        <span style="{% if task.completed %}text-decoration: line-through; color: #aaa;{% endif %}">
          {{ task.description }}
          {% if task.due_date %}
            <span class="badge bg-dark border text-light ms-2">
              Due: {{ task.due_date.strftime('%b %d') }}
            </span>
          {% endif %}
          {% if task.priority and task.priority != 'None' %}
            <span class="badge {{ 'bg-danger' if task.priority == 'High' else 'bg-warning text-dark' }} ms-1">
              {{ task.priority }}
            </span>
          {% endif %}
          {% if task.recurring and task.recurring != 'None' %}
            <span class="badge bg-secondary text-light ms-1">
              {{ task.recurring }}
            </span>
          {% endif %}
        </span>
      </div>
      <div class="d-flex align-items-center">
        <button class="btn btn-sm btn-outline-secondary me-1"
                onclick="openEditModal({{ task.id }}, '{{ task.description }}', '{{ task.due_date.strftime('%Y-%m-%d') if task.due_date else '' }}', '{{ task.priority }}', '{{ task.recurring }}')">
          <i class="bi bi-pencil"></i>
        </button>
        <button class="btn btn-sm btn-outline-danger" onclick="openDeleteModal({{ task.id }})">
          <i class="bi bi-trash"></i>
        </button>
      </div>
    </li>
  {% else %}
    <li class="list-group-item text-center text-muted border-secondary">
      No active tasks. Go do something dangerous and fulfilling.
    </li>
  {% endfor %}
</ul>

<h5 class="text-warning">Completed Tasks</h5>
<ul id="completedTasksList" class="list-group mb-4">
  {% for task in completed_tasks %}
    <li id="task-{{ task.id }}" class="list-group-item d-flex justify-content-between align-items-center border-secondary">
      <div class="d-flex align-items-center">
        <input type="checkbox"
               name="completed"
               onchange="toggleTaskComplete({{ task.id }})"
               class="form-check-input me-2"
               {% if task.completed %}checked{% endif %}>
        <span style="text-decoration: line-through; color: #666;">
          {{ task.description }}
          {% if task.due_date %}
            <span class="badge bg-dark border text-light ms-2">
              Due: {{ task.due_date.strftime('%b %d') }}
            </span>
          {% endif %}
          {% if task.priority and task.priority != 'None' %}
            <span class="badge bg-warning text-dark ms-1">
              {{ task.priority }}
            </span>
          {% endif %}
          {% if task.recurring and task.recurring != 'None' %}
            <span class="badge bg-secondary text-light ms-1">
              {{ task.recurring }}
            </span>
          {% endif %}
        </span>
      </div>
      <div class="d-flex align-items-center">
        <button class="btn btn-sm btn-outline-secondary me-1"
                onclick="openEditModal({{ task.id }}, '{{ task.description }}', '{{ task.due_date.strftime('%Y-%m-%d') if task.due_date else '' }}', '{{ task.priority }}', '{{ task.recurring }}')">
          <i class="bi bi-pencil"></i>
        </button>
        <button class="btn btn-sm btn-outline-danger" onclick="openDeleteModal({{ task.id }})">
          <i class="bi bi-trash"></i>
        </button>
      </div>
    </li>
  {% else %}
    <li class="list-group-item text-center text-muted border-secondary">
      No completed tasks yet. Start somewhere.
    </li>
  {% endfor %}
</ul>
